1. Purpose
The purpose of this pfSense deployment is to act as the primary firewall and network gateway within a SOC-style home lab environment. pfSense is used to generate realistic firewall telemetry that can be ingested into Splunk for detection engineering, alerting, and analysis.

This setup allows for:

Monitoring allowed and blocked traffic

Simulating attacker behavior (e.g., port scans)

Practicing log ingestion and normalization

Building and validating SOC detections


2. Network Architecture Overview

The lab consists of four primary systems:

pfSense – Firewall and router

Splunk Server (Ubuntu) – Log ingestion, analysis, and alerting

Kali Linux – Attack simulation (Nmap scans)

Windows 10 Client - Used as the admin box for the project; accessed Splunk and pfSense GUI

3. pfSense Interface Configuration

pfSense is configured with:

WAN interface connected to the upstream network

LAN interface serving internal hosts (Splunk, Kali)

The LAN interface allows internal traffic by default to simulate a realistic enterprise environment where internal reconnaissance may not be immediately blocked.

4. Logging Configuration

pfSense logging is configured under:

Status → System Logs → Settings

Key logging settings:

Remote logging enabled

Log messages sent to remote syslog server

Splunk server IP specified

UDP port 5514 used

Firewall events enabled

These settings ensure that firewall activity is forwarded in real time to Splunk.

5. Log Format (filterlog)

pfSense firewall events are generated by the filterlog process. Each log entry contains:

Action (pass/block)

Direction

Protocol

Source IP and port

Destination IP and port

TCP flags (when applicable)

These logs form the primary data source for network-based detections.

6. Why Logs Are Allowed, Not Blocked

In this lab, port scan activity from the Kali Linux host is allowed, not blocked. This mirrors real enterprise environments where:

Internal traffic is often trusted by default

Scanning may not immediately trigger prevention controls

Detection relies on analysis of patterns over time

This approach allows for more realistic SOC detection engineering.

7. Integration with Splunk

pfSense logs are ingested into Splunk via syslog and stored in a dedicated index. These logs are later used to:

Extract key fields (src_ip, dest_ip, dest_port)

Detect anomalous behavior

Trigger alerts based on thresholds

This pfSense setup serves as the foundation for all downstream detections in the SOC lab.
